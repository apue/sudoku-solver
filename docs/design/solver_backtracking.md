# 回溯求解语义（v1）

本文件定义 v1 的回溯求解器语义与“多解检测”口径。实现细节（如 MRV、值排序）不做强制要求，但必须满足下面的可观测行为。

## 支持范围

- 仅支持标准 9×9 数独（行/列/3×3 宫）
- 输入来自 `docs/design/io.md` 定义的 Puzzle JSON

## 求解目标与返回

求解器输出 `SolveResult`，其 JSON 形式见 `docs/design/io.md`。

- 若存在且仅存在 1 个解：`status=unique`，输出该解
- 若存在 ≥2 个解：`status=multiple`，输出其中任意一个解（但必须证明“至少两个解”）
- 若不存在解：`status=unsat`，`solution=null`

## 多解检测策略（强制）

为避免枚举所有解，v1 采用“找前两个解”的策略：

- 在回溯搜索中，最多搜集 `max_solutions=2` 个不同完整解
- 若找到第 2 个解，则可立即停止搜索并返回 `status=multiple`
- 若搜索结束且找到 0 个解：`unsat`
- 若搜索结束且找到 1 个解：`unique`

> 备注：这是“至少两个解”的检测，不要求计算总解数。

## 回溯搜索（行为要求）

- 深度优先（DFS）即可
- 每一步选择一个尚未赋值的格子，并尝试赋值 `1..9`
- 在尝试赋值时必须检测局部一致性：
  - 当前行/列/宫不得出现重复数字
  - 发现冲突则回退（backtrack）
- 当所有格子都已赋值且无冲突：得到一个完整解

## Stats（统计口径）

`stats` 必须至少包含（名称可固定为以下英文字段）：

- `calls`：递归调用次数（或“节点访问次数”）——每进入一次搜索函数记一次
- `assignments`：尝试赋值次数（对某个格子写入一个候选值的尝试）
- `backtracks`：回退次数（一次赋值尝试导致失败并撤销）
- `max_depth`：搜索达到的最大深度（已赋值格子数或递归深度均可，但需在实现中解释一致的口径）

更完整字段见 `docs/design/trace.md`。

